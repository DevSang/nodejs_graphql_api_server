<script>
    function handleClick() {
        var mode = getParameterByName('mode');
        var actionCode = getParameterByName('oobCode');
        // (Optional) Get the continue URL from the query parameter if available.
        var continueUrl = getParameterByName('continueUrl');
        // (Optional) Get the language code if available.
        var lang = getParameterByName('lang') || 'en';

        var config = {
            'apiKey': 'AIzaSyARn8P7lNVY0DnVHj_haa321Wyzm9HMKeo'
        };
        var app = firebase.initializeApp(config);
        var auth = app.auth()
        // Get the one-time code from the query parameter.
        var pw = document.getElementById('pw').value;
        var pw2 = document.getElementById('pw2').value;
        if(pw === pw2) {
            alert('change Pw!!!', pw)
                auth.verifyPasswordResetCode(actionCode).then(function(pw) {
                    auth.confirmPasswordReset(actionCode, pw).then(function(resp) {
                    // Password reset has been confirmed and new password updated.
                        alert('success Change PW')
                        document.getElementById('changePassword').style.display = "none";
                        document.getElementById('successText').style.display = "block";
                        document.getElementById('successText2').style.display = "block";
                    // TODO: Display a link back to the app, or sign-in the user directly
                    // if the page belongs to the same domain as the app:
                    // auth.signInWithEmailAndPassword(accountEmail, newPassword);

                    // TODO: If a continue URL is available, display a button which on
                    // click redirects the user back to the app via continueUrl with
                    // additional state determined from that URL's parameters.
                    }).catch(function(error) {
                        alert('error', error.message)
                        document.getElementById('changePassword').style.display = "none";
                        document.getElementById('failText').style.display = "block";
                        document.getElementById('failText2').style.display = "block";
                    });
                
                // location.href='https://looncupapp.page.link/app'
            }).catch(function(error) {
                alert(error.message)
                document.getElementById('changePassword').style.display = "none";
                document.getElementById('failText').style.display = "block";
                document.getElementById('failText2').style.display = "block";
            });

            // close the window
            setTimeout(function() {
                close();
            }, 3000);
        } else {
            alert('fail pw!!!', pw, pw2)
        }
    }

    function handleDeleteButton1() {
        document.getElementById('pw').value = "";
    }

    function handleDeleteButton2() {
        document.getElementById('pw2').value = "";
    }

    function checkPwLength(target) {
        var text = target.value;
        if(text.length >= 5 && text.length <= 10) {
            document.getElementById('pwL').style.color = "white";
        } else {
            document.getElementById('pwL').style.color = "#eb454f";
        }
        return '';
    }

    function checkPw(target) {
        var text = target.value;
        var pw = document.getElementById('pw').value;
        if(text == pw) {
            document.getElementById('pwM').style.color = "white";
        } else {
            document.getElementById('pwM').style.color = "#eb454f";
        }
        return '';
    }
</script>
<img border="pixels" style="border-width: 1px; border-color: #aaa;" src="/asset/mailBox.png"/>
<div>
    <div style="position: absolute;left: 80px; top: 1000px;font-size: 38pt;font-family:Brown-Bold; line-height:1.3em; width: 99.5%;">
        <div style="margin-bottom: 12%;">Change Password</div>
        <div style="display:flex; justify-content: space-between;">
            <input id="pw" type="password" placeholder="More than 5 letters"
            onchange="checkPwLength(this);"
            style="font-family:Brown-Bold; font-size: 38pt; padding: 0 20px; width:100%;" />
            <input style="margin: 0 20px" type="image" src="/asset/delete@3x.png" onclick="handleDeleteButton1();"/>
        </div>
        <hr style="margin-block-start: 0.5em; margin-block-end: 0.1em;" />
        <div id="pwL" style="font-size: 3.8vw;font-family: 'Brown-Regular';color: white; padding: 0 20px;margin-bottom: 1.3em;">Password must be between 5 and 10 characters long.</div>
        <div style="display:flex; justify-content: space-between;">
            <input id="pw2" type="password" placeholder="Confirm password"
            onchange="checkPw(this);"
             style="font-family:Brown-Bold; font-size: 38pt; padding: 0 20px; width:100%;" />
            <input style="margin: 0 20px" type="image" src="/asset/delete@3x.png" onclick="handleDeleteButton2();"/>
        </div>
        <hr style="margin-block-start: 0.5em; margin-block-end: 0.1em;" />
        <div id="pwM" style="font-size: 3.8vw;font-family: 'Brown-Regular';color: white;padding: 0 20px;margin-bottom: 1.3em;">Passwords do not match.</div>
        <div style="display:flex; justify-content: space-between;">
    </div>
</div>
<input id="changePassword" style="width:1000px; position:absolute; top:1650px;left:67px" type="image" src="/asset/verifyButton@2x.png" onclick="handleClick();"/>
<p id="successText" style="display:none; position: absolute;top:1650px;left:390px;font-size: 38pt;font-family:Brown-Bold; line-height:1.3em">
    Success to change password.
</p>
<p id="successText2" style="display:none;position: absolute;top:1650px;left:345px;font-size: 30pt;font-family:Brown-Bold; line-height:1.3em">
    The window will close.
</p>
<p id="failText" style="display:none;position: absolute;top:1650px;left:290px;font-size: 38pt;font-family:Brown-Bold; line-height:1.3em">
    Fail to change password.
</p>
<p id="efailText2" style="display:none;position: absolute;top:1650px;left:345px;font-size: 30pt;font-family:Brown-Bold; line-height:1.3em">
    The window will close.
</p>